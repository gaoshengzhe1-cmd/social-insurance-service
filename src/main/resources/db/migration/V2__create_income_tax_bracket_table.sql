-- 创建源泉税表
CREATE TABLE income_tax_bracket (
    id BIGSERIAL PRIMARY KEY,
    min_salary INTEGER NOT NULL,
    max_salary INTEGER NOT NULL,
    dependents_0 NUMERIC(10, 2) NOT NULL,
    dependents_1 NUMERIC(10, 2) NOT NULL,
    dependents_2 NUMERIC(10, 2) NOT NULL,
    dependents_3 NUMERIC(10, 2) NOT NULL,
    dependents_4 NUMERIC(10, 2) NOT NULL,
    dependents_5 NUMERIC(10, 2) NOT NULL,
    dependents_6 NUMERIC(10, 2) NOT NULL,
    dependents_7 NUMERIC(10, 2) NOT NULL,
    tax_amount_col_b NUMERIC(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_income_tax_bracket_salary ON income_tax_bracket(min_salary, max_salary);

-- 创建触发器函数
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 创建触发器
CREATE TRIGGER update_income_tax_bracket_updated_at
    BEFORE UPDATE ON income_tax_bracket
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- 插入示例数据（请根据实际的源泉税表补充完整数据）
-- 格式：min_salary, max_salary, 0人, 1人, 2人, 3人, 4人, 5人, 6人, 7人, 乙栏
INSERT INTO income_tax_bracket 
(min_salary, max_salary, dependents_0, dependents_1, dependents_2, dependents_3, 
 dependents_4, dependents_5, dependents_6, dependents_7, tax_amount_col_b)
VALUES
-- 以下为示例数据，请根据实际税率表更新
(440000, 450000, 10000, 9000, 8000, 7000, 6000, 5000, 4000, 3000, 2000),
(450000, 460000, 11000, 10000, 9000, 8000, 7000, 6000, 5000, 4000, 3000),
(460000, 470000, 12000, 11000, 10000, 9000, 8000, 7000, 6000, 5000, 4000),
(470000, 480000, 13000, 12000, 11000, 10000, 9000, 8000, 7000, 6000, 5000),
(480000, 490000, 14000, 13000, 12000, 11000, 10000, 9000, 8000, 7000, 6000),
(490000, 500000, 15000, 14000, 13000, 12000, 11000, 10000, 9000, 8000, 7000),
(500000, 510000, 16000, 15000, 14000, 13000, 12000, 11000, 10000, 9000, 8000),
(510000, 520000, 17000, 16000, 15000, 14000, 13000, 12000, 11000, 10000, 9000),
(520000, 530000, 18000, 17000, 16000, 15000, 14000, 13000, 12000, 11000, 10000),
(530000, 540000, 19000, 18000, 17000, 16000, 15000, 14000, 13000, 12000, 11000),
(540000, 550000, 20000, 19000, 18000, 17000, 16000, 15000, 14000, 13000, 12000),
(550000, 560000, 21000, 20000, 19000, 18000, 17000, 16000, 15000, 14000, 13000),
(560000, 570000, 22000, 21000, 20000, 19000, 18000, 17000, 16000, 15000, 14000),
(570000, 580000, 23000, 22000, 21000, 20000, 19000, 18000, 17000, 16000, 15000),
(580000, 590000, 24000, 23000, 22000, 21000, 20000, 19000, 18000, 17000, 16000),
(590000, 600000, 25000, 24000, 23000, 22000, 21000, 20000, 19000, 18000, 17000),
(600000, 610000, 26000, 25000, 24000, 23000, 22000, 21000, 20000, 19000, 18000),
(610000, 620000, 27000, 26000, 25000, 24000, 23000, 22000, 21000, 20000, 19000),
(620000, 630000, 28000, 27000, 26000, 25000, 24000, 23000, 22000, 21000, 20000),
(630000, 640000, 29000, 28000, 27000, 26000, 25000, 24000, 23000, 22000, 21000),
(640000, 650000, 30000, 29000, 28000, 27000, 26000, 25000, 24000, 23000, 22000),
(650000, 660000, 31000, 30000, 29000, 28000, 27000, 26000, 25000, 24000, 23000),
(660000, 670000, 32000, 31000, 30000, 29000, 28000, 27000, 26000, 25000, 24000),
(670000, 680000, 33000, 32000, 31000, 30000, 29000, 28000, 27000, 26000, 25000),
(680000, 690000, 34000, 33000, 32000, 31000, 30000, 29000, 28000, 27000, 26000),
(690000, 700000, 35000, 34000, 33000, 32000, 31000, 30000, 29000, 28000, 27000),
(700000, 710000, 36000, 35000, 34000, 33000, 32000, 31000, 30000, 29000, 28000),
(710000, 720000, 37000, 36000, 35000, 34000, 33000, 32000, 31000, 30000, 29000),
(720000, 730000, 38000, 37000, 36000, 35000, 34000, 33000, 32000, 31000, 30000),
(730000, 740000, 39000, 38000, 37000, 36000, 35000, 34000, 33000, 32000, 31000),
(740000, 750000, 40000, 39000, 38000, 37000, 36000, 35000, 34000, 33000, 32000),
(750000, 760000, 41000, 40000, 39000, 38000, 37000, 36000, 35000, 34000, 33000),
(760000, 770000, 42000, 41000, 40000, 39000, 38000, 37000, 36000, 35000, 34000),
(770000, 780000, 43000, 42000, 41000, 40000, 39000, 38000, 37000, 36000, 35000),
(780000, 790000, 44000, 43000, 42000, 41000, 40000, 39000, 38000, 37000, 36000),
(790000, 800000, 45000, 44000, 43000, 42000, 41000, 40000, 39000, 38000, 37000),
(800000, 810000, 46000, 45000, 44000, 43000, 42000, 41000, 40000, 39000, 38000),
(810000, 820000, 47000, 46000, 45000, 44000, 43000, 42000, 41000, 40000, 39000),
(820000, 830000, 48000, 47000, 46000, 45000, 44000, 43000, 42000, 41000, 40000),
(830000, 840000, 49000, 48000, 47000, 46000, 45000, 44000, 43000, 42000, 41000),
(840000, 850000, 50000, 49000, 48000, 47000, 46000, 45000, 44000, 43000, 42000),
(850000, 860000, 51000, 50000, 49000, 48000, 47000, 46000, 45000, 44000, 43000),
(860000, 870000, 52000, 51000, 50000, 49000, 48000, 47000, 46000, 45000, 44000),
(870000, 880000, 53000, 52000, 51000, 50000, 49000, 48000, 47000, 46000, 45000),
(880000, 890000, 54000, 53000, 52000, 51000, 50000, 49000, 48000, 47000, 46000),
(890000, 900000, 55000, 54000, 53000, 52000, 51000, 50000, 49000, 48000, 47000),
(900000, 910000, 56000, 55000, 54000, 53000, 52000, 51000, 50000, 49000, 48000),
(910000, 920000, 57000, 56000, 55000, 54000, 53000, 52000, 51000, 50000, 49000),
(920000, 930000, 58000, 57000, 56000, 55000, 54000, 53000, 52000, 51000, 50000),
(930000, 940000, 59000, 58000, 57000, 56000, 55000, 54000, 53000, 52000, 51000),
(940000, 950000, 60000, 59000, 58000, 57000, 56000, 55000, 54000, 53000, 52000),
(950000, 960000, 61000, 60000, 59000, 58000, 57000, 56000, 55000, 54000, 53000),
(960000, 970000, 62000, 61000, 60000, 59000, 58000, 57000, 56000, 55000, 54000),
(970000, 980000, 63000, 62000, 61000, 60000, 59000, 58000, 57000, 56000, 55000),
(980000, 990000, 64000, 63000, 62000, 61000, 60000, 59000, 58000, 57000, 56000),
(990000, 1000000, 65000, 64000, 63000, 62000, 61000, 60000, 59000, 58000, 57000),
(1000000, 1010000, 66000, 65000, 64000, 63000, 62000, 61000, 60000, 59000, 58000),
(1010000, 1020000, 67000, 66000, 65000, 64000, 63000, 62000, 61000, 60000, 59000),
(1020000, 1030000, 68000, 67000, 66000, 65000, 64000, 63000, 62000, 61000, 60000),
(1030000, 1040000, 69000, 68000, 67000, 66000, 65000, 64000, 63000, 62000, 61000),
(1040000, 1050000, 70000, 69000, 68000, 67000, 66000, 65000, 64000, 63000, 62000),
(1050000, 2000000, 71000, 70000, 69000, 68000, 67000, 66000, 65000, 64000, 63000);

-- 添加表注释
COMMENT ON TABLE income_tax_bracket IS '源泉税（所得税）税額表';
COMMENT ON COLUMN income_tax_bracket.min_salary IS '扣除社会保险费等后的工资金额（以上）';
COMMENT ON COLUMN income_tax_bracket.max_salary IS '扣除社会保险费等后的工资金额（未満）';
COMMENT ON COLUMN income_tax_bracket.dependents_0 IS '扶养亲属0人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_1 IS '扶养亲属1人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_2 IS '扶养亲属2人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_3 IS '扶养亲属3人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_4 IS '扶养亲属4人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_5 IS '扶养亲属5人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_6 IS '扶养亲属6人的税额';
COMMENT ON COLUMN income_tax_bracket.dependents_7 IS '扶养亲属7人的税额';
COMMENT ON COLUMN income_tax_bracket.tax_amount_col_b IS '乙栏税额';
COMMENT ON COLUMN income_tax_bracket.created_at IS '创建时间';
COMMENT ON COLUMN income_tax_bracket.updated_at IS '更新时间';
