-- 彻底修复源泉税表问题
-- 先删除表
DROP TABLE IF EXISTS income_tax_bracket;

-- 重新创建表，确保没有约束问题
CREATE TABLE income_tax_bracket (
    id BIGSERIAL PRIMARY KEY,
    min_salary INTEGER NOT NULL,
    max_salary INTEGER NOT NULL,
    dependents_0 INTEGER NOT NULL DEFAULT 0,
    dependents_1 INTEGER NOT NULL DEFAULT 0,
    dependents_2 INTEGER NOT NULL DEFAULT 0,
    dependents_3 INTEGER NOT NULL DEFAULT 0,
    dependents_4 INTEGER NOT NULL DEFAULT 0,
    dependents_5 INTEGER NOT NULL DEFAULT 0,
    dependents_6 INTEGER NOT NULL DEFAULT 0,
    dependents_7 INTEGER NOT NULL DEFAULT 0,
    tax_amount_col_b INTEGER NOT NULL DEFAULT 0
);

-- 创建索引以优化查询
CREATE INDEX idx_income_tax_bracket_salary ON income_tax_bracket (min_salary, max_salary);

-- 插入数据，使用严格的范围条件：min_salary <= salary < max_salary
INSERT INTO income_tax_bracket 
(min_salary, max_salary, dependents_0, dependents_1, dependents_2, dependents_3, 
 dependents_4, dependents_5, dependents_6, dependents_7, tax_amount_col_b)
VALUES
(88000, 89000, 1220, 0, 0, 0, 0, 0, 0, 0, 1220),
(89000, 90000, 1240, 0, 0, 0, 0, 0, 0, 0, 1240),
(90000, 91000, 1260, 0, 0, 0, 0, 0, 0, 0, 1260),
(91000, 92000, 1290, 0, 0, 0, 0, 0, 0, 0, 1290),
(92000, 93000, 1310, 0, 0, 0, 0, 0, 0, 0, 1310),
(93000, 94000, 1330, 0, 0, 0, 0, 0, 0, 0, 1330),
(94000, 95000, 1350, 0, 0, 0, 0, 0, 0, 0, 1350),
(95000, 96000, 1370, 0, 0, 0, 0, 0, 0, 0, 1370),
(96000, 97000, 1390, 0, 0, 0, 0, 0, 0, 0, 1390),
(97000, 98000, 1410, 0, 0, 0, 0, 0, 0, 0, 1410),
(98000, 99000, 1440, 0, 0, 0, 0, 0, 0, 0, 1440),
(99000, 100000, 1460, 0, 0, 0, 0, 0, 0, 0, 1460),
(100000, 101000, 1480, 0, 0, 0, 0, 0, 0, 0, 1480),
(101000, 102000, 1500, 0, 0, 0, 0, 0, 0, 0, 1500),
(102000, 103000, 1520, 0, 0, 0, 0, 0, 0, 0, 1520),
(103000, 104000, 1540, 0, 0, 0, 0, 0, 0, 0, 1540),
(104000, 105000, 1560, 0, 0, 0, 0, 0, 0, 0, 1560),
(105000, 106000, 1580, 0, 0, 0, 0, 0, 0, 0, 1580),
(106000, 107000, 1600, 0, 0, 0, 0, 0, 0, 0, 1600),
(107000, 108000, 1620, 0, 0, 0, 0, 0, 0, 0, 1620),
(108000, 109000, 1640, 0, 0, 0, 0, 0, 0, 0, 1640),
(109000, 110000, 1660, 0, 0, 0, 0, 0, 0, 0, 1660),
(110000, 115000, 1680, 0, 0, 0, 0, 0, 0, 0, 1680),
(115000, 120000, 1760, 0, 0, 0, 0, 0, 0, 0, 1760),
(120000, 130000, 1840, 0, 0, 0, 0, 0, 0, 0, 1840),
(130000, 140000, 2000, 0, 0, 0, 0, 0, 0, 0, 2000),
(140000, 150000, 2160, 0, 0, 0, 0, 0, 0, 0, 2160),
(157000, 159000, 3270, 1640, 0, 0, 0, 0, 0, 0, 3270),
(159000, 161000, 3340, 1720, 100, 0, 0, 0, 0, 0, 3340),
(161000, 163000, 2480, 1240, 0, 0, 0, 0, 0, 0, 2480),
(163000, 165000, 2560, 1320, 0, 0, 0, 0, 0, 0, 2560),
(165000, 167000, 2640, 1400, 0, 0, 0, 0, 0, 0, 2640),
(167000, 170000, 2720, 1480, 0, 0, 0, 0, 0, 0, 2720),
(170000, 173000, 2800, 1560, 0, 0, 0, 0, 0, 0, 2800),
(173000, 175000, 2880, 1640, 0, 0, 0, 0, 0, 0, 2880),
(175000, 177000, 2960, 1720, 0, 0, 0, 0, 0, 0, 2960),
(177000, 180000, 3040, 1800, 0, 0, 0, 0, 0, 0, 3040),
(180000, 183000, 3120, 1880, 0, 0, 0, 0, 0, 0, 3120),
(183000, 185000, 3200, 1960, 0, 0, 0, 0, 0, 0, 3200),
(185000, 187000, 3280, 2040, 0, 0, 0, 0, 0, 0, 3280),
(187000, 190000, 3360, 2120, 0, 0, 0, 0, 0, 0, 3360),
(190000, 193000, 3440, 2200, 0, 0, 0, 0, 0, 0, 3440),
(193000, 195000, 3520, 2280, 0, 0, 0, 0, 0, 0, 3520),
(195000, 197000, 3600, 2360, 0, 0, 0, 0, 0, 0, 3600),
(197000, 200000, 3680, 2440, 0, 0, 0, 0, 0, 0, 3680),
(200000, 203000, 3760, 2520, 0, 0, 0, 0, 0, 0, 3760),
(203000, 205000, 3840, 2600, 0, 0, 0, 0, 0, 0, 3840),
(205000, 207000, 3920, 2680, 0, 0, 0, 0, 0, 0, 3920),
(207000, 210000, 4000, 2760, 0, 0, 0, 0, 0, 0, 4000),
(210000, 213000, 4080, 2840, 0, 0, 0, 0, 0, 0, 4080),
(213000, 215000, 4160, 2920, 0, 0, 0, 0, 0, 0, 4160),
(215000, 217000, 4240, 3000, 0, 0, 0, 0, 0, 0, 4240),
(217000, 220000, 4320, 3080, 0, 0, 0, 0, 0, 0, 4320),
(220000, 223000, 4400, 3160, 0, 0, 0, 0, 0, 0, 4400),
(223000, 225000, 4480, 3240, 0, 0, 0, 0, 0, 0, 4480),
(225000, 227000, 4560, 3320, 0, 0, 0, 0, 0, 0, 4560),
(227000, 230000, 4640, 3400, 0, 0, 0, 0, 0, 0, 4640),
(230000, 233000, 4720, 3480, 0, 0, 0, 0, 0, 0, 4720),
(233000, 235000, 4800, 3560, 0, 0, 0, 0, 0, 0, 4800),
(235000, 237000, 4880, 3640, 0, 0, 0, 0, 0, 0, 4880),
(237000, 240000, 4960, 3720, 0, 0, 0, 0, 0, 0, 4960),
(240000, 243000, 5040, 3800, 0, 0, 0, 0, 0, 0, 5040),
(243000, 245000, 5120, 3880, 0, 0, 0, 0, 0, 0, 5120),
(245000, 247000, 5200, 3960, 0, 0, 0, 0, 0, 0, 5200),
(247000, 250000, 5280, 4040, 0, 0, 0, 0, 0, 0, 5280),
(250000, 253000, 5360, 4120, 0, 0, 0, 0, 0, 0, 5360),
(253000, 255000, 5440, 4200, 0, 0, 0, 0, 0, 0, 5440),
(255000, 257000, 5520, 4280, 0, 0, 0, 0, 0, 0, 5520),
(257000, 260000, 5600, 4360, 0, 0, 0, 0, 0, 0, 5600),
(260000, 263000, 5680, 4440, 0, 0, 0, 0, 0, 0, 5680),
(263000, 265000, 5760, 4520, 0, 0, 0, 0, 0, 0, 5760),
(265000, 267000, 5840, 4600, 0, 0, 0, 0, 0, 0, 5840),
(267000, 270000, 5920, 4680, 0, 0, 0, 0, 0, 0, 5920),
(270000, 273000, 6000, 4760, 0, 0, 0, 0, 0, 0, 6000),
(273000, 275000, 6080, 4840, 0, 0, 0, 0, 0, 0, 6080),
(275000, 277000, 6160, 4920, 0, 0, 0, 0, 0, 0, 6160),
(277000, 280000, 6240, 5000, 0, 0, 0, 0, 0, 0, 6240),
(280000, 283000, 6320, 5080, 0, 0, 0, 0, 0, 0, 6320),
(283000, 285000, 6400, 5160, 0, 0, 0, 0, 0, 0, 6400),
(285000, 287000, 6480, 5240, 0, 0, 0, 0, 0, 0, 6480),
(287000, 290000, 6560, 5320, 0, 0, 0, 0, 0, 0, 6560),
(290000, 293000, 6640, 5400, 0, 0, 0, 0, 0, 0, 6640),
(293000, 295000, 6720, 5480, 0, 0, 0, 0, 0, 0, 6720),
(295000, 297000, 6800, 5560, 0, 0, 0, 0, 0, 0, 6800),
(297000, 300000, 6880, 5640, 0, 0, 0, 0, 0, 0, 6880),
(300000, 303000, 6960, 5720, 0, 0, 0, 0, 0, 0, 6960),
(303000, 305000, 7040, 5800, 0, 0, 0, 0, 0, 0, 7040),
(305000, 307000, 7120, 5880, 0, 0, 0, 0, 0, 0, 7120),
(307000, 310000, 7200, 5960, 0, 0, 0, 0, 0, 0, 7200),
(310000, 313000, 7280, 6040, 0, 0, 0, 0, 0, 0, 7280),
(313000, 315000, 7360, 6120, 0, 0, 0, 0, 0, 0, 7360),
(315000, 317000, 7440, 6200, 0, 0, 0, 0, 0, 0, 7440),
(317000, 320000, 7520, 6280, 0, 0, 0, 0, 0, 0, 7520),
(320000, 323000, 7600, 6360, 0, 0, 0, 0, 0, 0, 7600),
(323000, 325000, 7680, 6440, 0, 0, 0, 0, 0, 0, 7680),
(325000, 327000, 7760, 6520, 0, 0, 0, 0, 0, 0, 7760),
(327000, 330000, 7840, 6600, 0, 0, 0, 0, 0, 0, 7840),
(330000, 333000, 7920, 6680, 0, 0, 0, 0, 0, 0, 7920),
(333000, 335000, 8000, 6760, 0, 0, 0, 0, 0, 0, 8000),
(335000, 337000, 8080, 6840, 0, 0, 0, 0, 0, 0, 8080),
(337000, 340000, 8160, 6920, 0, 0, 0, 0, 0, 0, 8160),
(340000, 343000, 8240, 7000, 0, 0, 0, 0, 0, 0, 8240),
(343000, 345000, 8320, 7080, 0, 0, 0, 0, 0, 0, 8320),
(345000, 347000, 8400, 7160, 0, 0, 0, 0, 0, 0, 8400),
(347000, 350000, 8480, 7240, 0, 0, 0, 0, 0, 0, 8480),
(350000, 353000, 8560, 7320, 0, 0, 0, 0, 0, 0, 8560),
(353000, 355000, 8640, 7400, 0, 0, 0, 0, 0, 0, 8640),
(355000, 357000, 8720, 7480, 0, 0, 0, 0, 0, 0, 8720),
(357000, 360000, 8800, 7560, 0, 0, 0, 0, 0, 0, 8800),
(360000, 363000, 8880, 7640, 0, 0, 0, 0, 0, 0, 8880),
(363000, 365000, 8960, 7720, 0, 0, 0, 0, 0, 0, 8960),
(365000, 367000, 9040, 7800, 0, 0, 0, 0, 0, 0, 9040),
(367000, 370000, 9120, 7880, 0, 0, 0, 0, 0, 0, 9120),
(370000, 373000, 9200, 7960, 0, 0, 0, 0, 0, 0, 9200),
(373000, 375000, 9280, 8040, 0, 0, 0, 0, 0, 0, 9280),
(375000, 377000, 9360, 8120, 0, 0, 0, 0, 0, 0, 9360),
(377000, 380000, 9440, 8200, 0, 0, 0, 0, 0, 0, 9440),
(380000, 383000, 9520, 8280, 0, 0, 0, 0, 0, 0, 9520),
(383000, 385000, 9600, 8360, 0, 0, 0, 0, 0, 0, 9600),
(385000, 387000, 9680, 8440, 0, 0, 0, 0, 0, 0, 9680),
(387000, 390000, 9760, 8520, 0, 0, 0, 0, 0, 0, 9760),
(390000, 393000, 9840, 8600, 0, 0, 0, 0, 0, 0, 9840),
(393000, 395000, 9920, 8680, 0, 0, 0, 0, 0, 0, 9920),
(395000, 397000, 10000, 8760, 0, 0, 0, 0, 0, 0, 10000),
(397000, 400000, 10080, 8840, 0, 0, 0, 0, 0, 0, 10080),
(400000, 403000, 10160, 8920, 0, 0, 0, 0, 0, 0, 10160),
(403000, 405000, 10240, 9000, 0, 0, 0, 0, 0, 0, 10240),
(405000, 407000, 10320, 9080, 0, 0, 0, 0, 0, 0, 10320),
(407000, 410000, 10400, 9160, 0, 0, 0, 0, 0, 0, 10400),
(410000, 413000, 10480, 9240, 0, 0, 0, 0, 0, 0, 10480),
(413000, 415000, 10560, 9320, 0, 0, 0, 0, 0, 0, 10560),
(415000, 417000, 10640, 9400, 0, 0, 0, 0, 0, 0, 10640),
(417000, 420000, 10720, 9480, 0, 0, 0, 0, 0, 0, 10720),
(420000, 423000, 10800, 9560, 0, 0, 0, 0, 0, 0, 10800),
(423000, 425000, 10880, 9640, 0, 0, 0, 0, 0, 0, 10880),
(425000, 427000, 10960, 9720, 0, 0, 0, 0, 0, 0, 10960),
(427000, 430000, 11040, 9800, 0, 0, 0, 0, 0, 0, 11040),
(430000, 433000, 11120, 9880, 0, 0, 0, 0, 0, 0, 11120),
(433000, 435000, 11200, 9960, 0, 0, 0, 0, 0, 0, 11200),
(435000, 437000, 11280, 10040, 0, 0, 0, 0, 0, 0, 11280),
(437000, 440000, 11360, 10120, 0, 0, 0, 0, 0, 0, 11360),
(440000, 443000, 11440, 10200, 0, 0, 0, 0, 0, 0, 11440),
(443000, 445000, 11520, 10280, 0, 0, 0, 0, 0, 0, 11520),
(445000, 447000, 11600, 10360, 0, 0, 0, 0, 0, 0, 11600),
(447000, 450000, 11680, 10440, 0, 0, 0, 0, 0, 0, 11680),
(450000, 453000, 11760, 10520, 0, 0, 0, 0, 0, 0, 11760),
(453000, 455000, 11840, 10600, 0, 0, 0, 0, 0, 0, 11840),
(455000, 457000, 11920, 10680, 0, 0, 0, 0, 0, 0, 11920),
(457000, 460000, 12000, 10760, 0, 0, 0, 0, 0, 0, 12000),
(460000, 463000, 12080, 10840, 0, 0, 0, 0, 0, 0, 12080),
(463000, 465000, 12160, 10920, 0, 0, 0, 0, 0, 0, 12160),
(465000, 467000, 12240, 11000, 0, 0, 0, 0, 0, 0, 12240),
(467000, 470000, 12320, 11080, 0, 0, 0, 0, 0, 0, 12320),
(470000, 473000, 12400, 11160, 0, 0, 0, 0, 0, 0, 12400),
(473000, 475000, 12480, 11240, 0, 0, 0, 0, 0, 0, 12480),
(475000, 477000, 12560, 11320, 0, 0, 0, 0, 0, 0, 12560),
(477000, 480000, 12640, 11400, 0, 0, 0, 0, 0, 0, 12640),
(480000, 483000, 12720, 11480, 0, 0, 0, 0, 0, 0, 12720),
(483000, 485000, 12800, 11560, 0, 0, 0, 0, 0, 0, 12800),
(485000, 487000, 12880, 11640, 0, 0, 0, 0, 0, 0, 12880),
(487000, 490000, 12960, 11720, 0, 0, 0, 0, 0, 0, 12960),
(490000, 493000, 13040, 11800, 0, 0, 0, 0, 0, 0, 13040),
(493000, 495000, 13120, 11880, 0, 0, 0, 0, 0, 0, 13120),
(495000, 497000, 13200, 11960, 0, 0, 0, 0, 0, 0, 13200),
(497000, 500000, 13280, 12040, 0, 0, 0, 0, 0, 0, 13280),
(500000, 503000, 29890, 23430, 18370, 15140, 11900, 8670, 6870, 5250, 29890),
(503000, 507000, 30680, 24220, 19160, 15930, 12690, 9460, 7660, 6040, 30680),
(507000, 510000, 31470, 25010, 19950, 16720, 13480, 10250, 8450, 6830, 31470),
(510000, 550000, 32260, 25800, 20740, 17510, 14270, 11040, 9240, 7620, 32260),
(550000, 600000, 35840, 23520, 18460, 15230, 11990, 8760, 6960, 5340, 35840),
(600000, 650000, 39420, 27080, 22020, 18790, 15550, 12320, 10520, 8900, 39420),
(650000, 700000, 43000, 30640, 25580, 22350, 19110, 15880, 14080, 12460, 43000),
(700000, 750000, 46580, 34200, 29140, 25910, 22670, 19440, 17640, 16020, 46580),
(750000, 800000, 50160, 37760, 32700, 29470, 26230, 23000, 21200, 19580, 50160),
(800000, 850000, 53740, 41320, 36260, 33030, 29790, 26560, 24760, 23140, 53740),
(850000, 900000, 57320, 44880, 39820, 36590, 33350, 30120, 28320, 26700, 57320),
(900000, 950000, 60900, 48440, 43380, 40150, 36910, 33680, 31880, 30260, 60900),
(950000, 1000000, 64480, 52000, 46940, 43710, 40470, 37240, 35440, 33820, 64480),
(1000000, 1500000, 68060, 55560, 50500, 47270, 44030, 40800, 39000, 37380, 68060),
(1500000, 2000000, 96000, 83500, 78440, 75210, 71970, 68740, 66940, 65320, 96000),
(2000000, 2500000, 144000, 131500, 126440, 123210, 119970, 116740, 114940, 113320, 144000),
(2500000, 3000000, 192000, 179500, 174440, 171210, 167970, 164740, 162940, 161320, 192000),
(3000000, 3500000, 240000, 227500, 222440, 219210, 215970, 212740, 210940, 209320, 240000),
(3500000, 4000000, 288000, 275500, 270440, 267210, 263970, 260740, 258940, 257320, 288000),
(4000000, 4500000, 336000, 323500, 318440, 315210, 311970, 308740, 306940, 305320, 336000),
(4500000, 5000000, 384000, 371500, 366440, 363210, 359970, 356740, 354940, 353320, 384000),
(5000000, 5500000, 432000, 419500, 414440, 411210, 407970, 404740, 402940, 401320, 432000),
(5500000, 6000000, 480000, 467500, 462440, 459210, 455970, 452740, 450940, 449320, 480000),
(6000000, 6500000, 528000, 515500, 510440, 507210, 503970, 500740, 498940, 497320, 528000),
(6500000, 7000000, 576000, 563500, 558440, 555210, 551970, 548740, 546940, 545320, 576000),
(7000000, 7500000, 624000, 611500, 606440, 603210, 599970, 596740, 594940, 593320, 624000),
(7500000, 8000000, 672000, 659500, 654440, 651210, 647970, 644740, 642940, 641320, 672000),
(8000000, 8500000, 720000, 707500, 702440, 699210, 695970, 692740, 690940, 689320, 720000),
(8500000, 9000000, 768000, 755500, 750440, 747210, 743970, 740740, 738940, 737320, 768000),
(9000000, 9500000, 816000, 803500, 798440, 795210, 791970, 788740, 786940, 785320, 816000),
(9500000, 10000000, 864000, 851500, 846440, 843210, 839970, 836740, 834940, 833320, 864000),
(10000000, 999999999, 912000, 899500, 894440, 891210, 887970, 884740, 882940, 881320, 912000);
